version: "3.7"

services:

  db:
# Postgres DB Container Version 11.4
    image: postgres:11.4
    networks:
      - polls_net
    volumes:
      - polls_vol:/var/lib/postgresql/data
    env_file:
      - project-files/deployment.env
    command:
      - 'postgres'
      - '-c'
      - 'wal_level=replica'
      - '-c'
      - 'archive_mode=on'

  app1:
    image: pythonincontainers/django-polls:nginx
    networks:
      - polls_net
    env_file:
      - project-files/deployment.env

  app2:
    image: pythonincontainers/django-polls:nginx
    networks:
      - polls_net
    env_file:
      - project-files/deployment.env

  proxy:
    image: pythonincontainers/mynginx:latest
    networks:
      - polls_net
    ports:
      - "8000:8000"
    volumes:
      - ./project-files/mynginx-conf-lb.conf:/etc/nginx/conf.d/mysite_nginx.conf

networks:
  polls_net:

volumes:
  polls_vol:
